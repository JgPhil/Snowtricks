{% extends "base.html.twig" %}
{% set route = app.request.attributes.get('_route') %}
{% set title = route == "figure_create" ? "Nouvelle figure" : "Modifier la figure" %}


{% form_theme figureForm 'bootstrap_4_layout.html.twig' %}

{% block title title %}

{% block body %}

	{% set order = 1 %}

	<div class="container">
		{% set defaultPicture = null %}
		{% for picture in trick.pictures %}
			{% if picture.sortOrder == 1 %}
				{% set defaultPicture = picture %}
			{% endif %}
		{% endfor %}
		{% set pictureJumbotron = defaultPicture ? " /uploads/pictures/" ~ defaultPicture.name : '' %}

		<div class="jumbotron align-items-center justify-content-center" style="background: url(' {{ pictureJumbotron|default('http://placehold.it/1300x800') }} ') no-repeat center;" id="topJumbotron">
			<h1 class="display-4" style="color:white"></h1>

			<div
				class="editButtonMenu">
				{#-----------UPDATE PICTURE --------#}
				<a data-toggle="collapse" href="#update_picture_input" role="button" aria-expanded="false" aria-controls="collapseExample">
					<i class="fas fa-pencil-alt fa-2x"></i>
				</a>

				<div class="collapse" id="update_picture_input">
					<input type="file" id="update_picture"/>
					<div hidden>{{ defaultPicture.sortOrder }}</div>
					<button>Envoyer</button>
				</div>
				{#!---------UPDATE PICTURE---------#}

				<a href="{{ path('picture_delete', { id: defaultPicture.id }) }}" data-delete>
					<i class="fas fa-trash-alt fa-2x"></i>
				</a>
			</div>

		</div>


		{{ form_start(figureForm) }}
		<div
			class="row">

			{# -------------------------FIGURES PICTURES------------------------ #}

			<div class="col-lg-6">
				<div class="row picture-thumbs">

					{% for picture in trick.pictures|slice(1) %}
						<div hidden>{{ picture.id }}</div>
						<div class="img-thumbnail col-sm-4">
							<img
							src="{{ asset('/uploads/pictures/' ~ picture.name) }}" alt="Image" width="150px">

							{#-----------UPDATE PICTURE --------#}
							<a data-toggle="collapse" href={{"#update_picture_input" ~ picture.id }} role="button" aria-expanded="false" aria-controls="collapseExample">
								<i class="fas fa-pencil-alt fa-2x"></i>
							</a>
							<a href="{{ path('picture_delete', {id: picture.id}) }} " data-delete>
								<i class="fas fa-trash-alt fa-2x"></i>
							</a>

							<div class="collapse" id={{"update_picture_input" ~ picture.id }}>
								<input type="file" id="update_picture"/>
								<div hidden>{{ picture.sortOrder }}</div>
								<!-- Picture sortOrder -->
								<button>Envoyer</button>
							</div>
							{#!---------UPDATE PICTURE---------#}

						</div>

						{% set order = order +1 %}
					{% endfor %}

				</div>

				<div class="col-sm-6">
					{{ form_row(figureForm.pictures) }}
				</div>

			</div>
			{# -------------------------FIGURES PICTURES------------------------ #}


			{# -------------------------FIGURES VIDEOS------------------------ #}
			<div class="col-lg-6">
				<div class="row">
					{% for video in trick.videos %}
						<div class="img-thumbnail">
							<iframe width="560" height="315" src="{{video.url}}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
							<button type="button" class="btn btn-info" data-toggle="modal" data-target="#uploadModal">Changer</button>
							<a href="{{ path('video_delete', {id: video.id}) }} " data-delete>Supprimer</a>
						</div>
					{% endfor %}

					{% for video in figureForm.videos %}
						<li>{{ form_row(video) }}</li>
					{% endfor %}
				</div>
			</div>
			{# -------------------------FIGURES VIDEOS------------------------ #}

		</div>


		{{ form_row(figureForm.title) }}
		{{ form_row(figureForm.description) }}


		{% if app.request.attributes.get('_route') ==  "figure_edit"  %}


			<div class="row">
				<div class="col-sm-6">
					{{ form_row(figureForm.category) }}
				</div>
				{{ form_row(figureForm.submit) }}
			</div>
			{{ form_end(figureForm) }}

		{% else %}


			{{ form_row(figureForm.videos) }}
			{{ form_row(figureForm.submit) }}

			{{ form_end(figureForm) }}
		</div>

	{% endif %}

{% endblock %}
{% block javascript %}
	<script src=" {{ asset('js/delete.js') }} "></script>
	<script src=" {{ asset('js/picture_update.js') }} "></script>
{% endblock %}
